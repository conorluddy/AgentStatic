{# components/atoms/link/link.njk #}

{#
  Link Component

  Description: Semantic anchor element for navigation and external links.
  Supports multiple style variants, icons, and accessibility features.

  Props:
    - text (string): Link text content (required)
    - href (string): Link destination URL (required)
    - variant (string): Visual style variant - 'default', 'muted', 'primary',
                       'underline', 'no-underline', 'hover-underline', 'cta', 'inherit'
                       (default: 'default')
    - external (boolean): If true, opens in new tab with rel="noopener noreferrer" (default: false)
    - download (boolean): If true, triggers download (default: false)
    - downloadFilename (string): Filename for download attribute
    - iconStart (string): SVG icon HTML to show before text
    - iconEnd (string): SVG icon HTML to show after text (auto-added for external links)
    - disabled (boolean): If true, link is non-interactive (default: false)
    - id (string): Unique identifier for the component
    - className (string): Additional CSS classes
    - attributes (object): Additional HTML attributes
    - a11y (object): Accessibility properties
      - ariaLabel (string): Accessible label (recommended for icon-only links)
      - ariaDescribedBy (string): ID of describing element
      - ariaLabelledBy (string): ID of labeling element
      - role (string): ARIA role override (rarely needed for links)

  Usage:
    {% from "atoms/link/link.njk" import link %}

    // Basic link
    {{ link({
      text: 'About Us',
      href: '/about'
    }) }}

    // External link with icon
    {{ link({
      text: 'Visit Example.com',
      href: 'https://example.com',
      external: true
    }) }}

    // CTA link
    {{ link({
      text: 'Get Started',
      href: '/signup',
      variant: 'cta'
    }) }}

    // Download link
    {{ link({
      text: 'Download PDF',
      href: '/files/document.pdf',
      download: true,
      downloadFilename: 'brochure.pdf'
    }) }}
#}

{% macro link(props = {}) %}
  {% set defaults = {
    text: '',
    href: '#',
    variant: 'default',
    external: false,
    download: false,
    downloadFilename: '',
    iconStart: '',
    iconEnd: '',
    disabled: false,
    className: '',
    attributes: {},
    a11y: {}
  } %}

  {% set config = defaults | merge(props) %}

  {# Build class list #}
  {% set classList = [
    'link',
    'link-' + config.variant
  ] %}

  {# Add external class if external link #}
  {% if config.external %}
    {% set classList = (classList.push('link-external'), classList) %}
  {% endif %}

  {# Add custom classes #}
  {% if config.className %}
    {% set classList = (classList.push(config.className), classList) %}
  {% endif %}

  {# Join class list #}
  {% set classString = classList | join(' ') | trim %}

  {# Determine target attribute #}
  {% set target = '_blank' if config.external else '' %}

  {# Determine rel attribute for security #}
  {% set rel = 'noopener noreferrer' if config.external else '' %}

  {# External link icon SVG #}
  {% set externalIcon %}
    <svg class="link-icon link-icon-external" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
      <path d="M6.22 8.72a.75.75 0 0 0 1.06 1.06l5.22-5.22v1.69a.75.75 0 0 0 1.5 0v-3.5a.75.75 0 0 0-.75-.75h-3.5a.75.75 0 0 0 0 1.5h1.69L6.22 8.72z"/>
      <path d="M3.5 6.75c0-.69.56-1.25 1.25-1.25H7A.75.75 0 0 0 7 4H4.75A2.75 2.75 0 0 0 2 6.75v4.5A2.75 2.75 0 0 0 4.75 14h4.5A2.75 2.75 0 0 0 12 11.25V9a.75.75 0 0 0-1.5 0v2.25c0 .69-.56 1.25-1.25 1.25h-4.5c-.69 0-1.25-.56-1.25-1.25v-4.5z"/>
    </svg>
  {% endset %}

  {# Download link icon SVG #}
  {% set downloadIcon %}
    <svg class="link-icon link-icon-download" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
      <path d="M8.75 2.75a.75.75 0 0 0-1.5 0v5.69L5.03 6.22a.75.75 0 0 0-1.06 1.06l3.5 3.5a.75.75 0 0 0 1.06 0l3.5-3.5a.75.75 0 0 0-1.06-1.06L8.75 8.44V2.75z"/>
      <path d="M3.5 9.75a.75.75 0 0 0-1.5 0v1.5A2.75 2.75 0 0 0 4.75 14h6.5A2.75 2.75 0 0 0 14 11.25v-1.5a.75.75 0 0 0-1.5 0v1.5c0 .69-.56 1.25-1.25 1.25h-6.5c-.69 0-1.25-.56-1.25-1.25v-1.5z"/>
    </svg>
  {% endset %}

  {# Main link element #}
  <a
    class="{{ classString }}"
    href="{{ config.href }}"
    {% if config.id %}id="{{ config.id }}"{% endif %}
    {% if target %}target="{{ target }}"{% endif %}
    {% if rel %}rel="{{ rel }}"{% endif %}
    {% if config.download %}download{% if config.downloadFilename %}="{{ config.downloadFilename }}"{% endif %}{% endif %}
    {% if config.disabled %}aria-disabled="true" tabindex="-1"{% endif %}
    {% if config.a11y.role %}role="{{ config.a11y.role }}"{% endif %}
    {% if config.a11y.ariaLabel %}aria-label="{{ config.a11y.ariaLabel }}"{% endif %}
    {% if config.a11y.ariaDescribedBy %}aria-describedby="{{ config.a11y.ariaDescribedBy }}"{% endif %}
    {% if config.a11y.ariaLabelledBy %}aria-labelledby="{{ config.a11y.ariaLabelledBy }}"{% endif %}
    {% for key, value in config.attributes %}
      {{ key }}="{{ value }}"
    {% endfor %}
  >
    {# Icon before text #}
    {% if config.iconStart %}
      <span class="link-icon">{{ config.iconStart | safe }}</span>
    {% endif %}

    {# Link text #}
    {% if config.text %}
      <span class="link-text">{{ config.text }}</span>
    {% endif %}

    {# Support for custom content via caller #}
    {{ caller() if caller }}

    {# Icon after text (custom or auto for external/download) #}
    {% if config.iconEnd %}
      <span class="link-icon">{{ config.iconEnd | safe }}</span>
    {% elif config.external %}
      {{ externalIcon | safe }}
    {% elif config.download %}
      {{ downloadIcon | safe }}
    {% endif %}
  </a>
{% endmacro %}
