{# components/atoms/breadcrumb/breadcrumb.njk #}

{#
  Breadcrumb Component

  Description: Navigation trail showing current location in site hierarchy.
  Displays path from home to current page with separators and proper ARIA markup.
  Supports Schema.org structured data for SEO rich snippets.

  Props:
    - items (array, required): Breadcrumb trail items
      - label (string, required): Display text for the item
      - href (string): URL for the item (omit for current page)
    - separator (string): Separator style - 'slash', 'chevron', 'arrow', 'dot' (default: 'chevron')
    - size (string): Size variant - 'sm', 'md', 'lg' (default: 'md')
    - truncate (boolean): Enable text truncation for long items (default: false)
    - schema (boolean): Include Schema.org structured data (default: false)
    - id (string): Unique identifier for the component
    - className (string): Additional CSS classes
    - attributes (object): Additional HTML attributes
    - a11y (object): Accessibility properties
      - ariaLabel (string): Accessible label (default: 'Breadcrumb')

  Usage:
    {% from "atoms/breadcrumb/breadcrumb.njk" import breadcrumb %}

    // Basic breadcrumb
    {{ breadcrumb({
      items: [
        { label: 'Home', href: '/' },
        { label: 'Products', href: '/products' },
        { label: 'Shoes' }
      ]
    }) }}

    // With different separator
    {{ breadcrumb({
      items: [
        { label: 'Home', href: '/' },
        { label: 'Blog', href: '/blog' },
        { label: 'Article Title' }
      ],
      separator: 'slash'
    }) }}

    // With Schema.org markup
    {{ breadcrumb({
      items: [
        { label: 'Home', href: '/' },
        { label: 'Category', href: '/category' },
        { label: 'Subcategory', href: '/category/sub' },
        { label: 'Current Page' }
      ],
      schema: true
    }) }}
#}

{% macro breadcrumb(props = {}) %}
  {# Import Link component #}
  {% from "atoms/link/link.njk" import link %}

  {% set defaults = {
    items: [],
    separator: 'chevron',
    size: 'md',
    truncate: false,
    schema: false,
    className: '',
    attributes: {},
    a11y: {
      ariaLabel: 'Breadcrumb'
    }
  } %}

  {% set config = defaults | merge(props) %}
  {% if props.a11y %}
    {% set config = config | merge({ a11y: defaults.a11y | merge(props.a11y) }) %}
  {% endif %}

  {# Build class list #}
  {% set classList = [
    'breadcrumb',
    'breadcrumb-' + config.size if config.size != 'md',
    'breadcrumb-truncate' if config.truncate,
    config.className
  ] | join(' ') | trim %}

  {# Separator SVG icons #}
  {% set chevronIcon %}
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
      <path fill-rule="evenodd" d="M6.22 4.22a.75.75 0 0 1 1.06 0l3.25 3.25a.75.75 0 0 1 0 1.06l-3.25 3.25a.75.75 0 0 1-1.06-1.06L8.94 8 6.22 5.28a.75.75 0 0 1 0-1.06z"/>
    </svg>
  {% endset %}

  {# Schema.org structured data (JSON-LD) #}
  {% if config.schema %}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {%- for item in config.items -%}
        {
          "@type": "ListItem",
          "position": {{ loop.index }},
          "name": "{{ item.label }}"{%- if item.href -%},
          "item": "{{ item.href }}"
          {%- endif -%}
        }{% if not loop.last %},{% endif %}
        {%- endfor -%}
      ]
    }
    </script>
  {% endif %}

  {# Main breadcrumb navigation #}
  <nav
    class="{{ classList }}"
    {% if config.id %}id="{{ config.id }}"{% endif %}
    aria-label="{{ config.a11y.ariaLabel }}"
    {% for key, value in config.attributes %}
      {{ key }}="{{ value }}"
    {% endfor %}
  >
    <ol class="breadcrumb-list">
      {% for item in config.items %}
        <li class="breadcrumb-item">
          {# Separator (not shown before first item) #}
          {% if not loop.first %}
            <span class="breadcrumb-separator breadcrumb-separator-{{ config.separator }}" aria-hidden="true">
              {%- if config.separator == 'chevron' -%}
                {{ chevronIcon | safe }}
              {%- endif -%}
            </span>
          {% endif %}

          {# Breadcrumb item content #}
          {% if item.href %}
            {# Link to previous page #}
            {{ link({
              text: item.label,
              href: item.href,
              variant: 'inherit',
              className: 'breadcrumb-link'
            }) }}
          {% else %}
            {# Current page (not a link) #}
            <span class="breadcrumb-current" aria-current="page">
              {{ item.label }}
            </span>
          {% endif %}
        </li>
      {% endfor %}
    </ol>
  </nav>
{% endmacro %}
