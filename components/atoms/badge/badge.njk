{# components/atoms/badge/badge.njk #}

{#
  Badge Component

  Description: Small inline label for status, notifications, categories, and marketing callouts.
  Perfect for highlighting urgency, social proof, and product features on brochureware sites.

  Props:
    - text (string): Badge text content (required for standard badges)
    - variant (string): Color variant - 'default', 'primary', 'secondary', 'success',
                       'warning', 'error', 'info' (default: 'default')
    - size (string): Size variant - 'sm', 'md', 'lg' (default: 'md')
    - style (string): Visual style - 'filled', 'outline', 'subtle' (default: 'filled')
    - shape (string): Shape variant - 'rounded', 'pill' (default: none)
    - icon (string): Icon HTML/SVG to display before text (optional)
    - dismissible (boolean): Show close button (default: false)
    - notification (boolean): Render as notification badge (circular with number) (default: false)
    - dot (boolean): Render as status dot indicator (default: false)
    - id (string): Unique identifier for the component
    - className (string): Additional CSS classes
    - attributes (object): Additional HTML attributes
    - a11y (object): Accessibility properties
      - ariaLabel (string): Accessible label (required for icon-only or notification badges)
      - ariaDescribedBy (string): ID of describing element
      - ariaLive (string): ARIA live region behavior for notifications

  Usage:
    {% from "atoms/badge/badge.njk" import badge %}

    Basic:
    {{ badge({ text: 'New' }) }}

    With variant and size:
    {{ badge({ text: 'Sale', variant: 'error', size: 'lg' }) }}

    Outline style:
    {{ badge({ text: 'Popular', variant: 'primary', style: 'outline' }) }}

    With icon:
    {{ badge({
      text: 'Verified',
      variant: 'success',
      icon: '<svg>...</svg>'
    }) }}

    Dismissible:
    {{ badge({
      text: 'Featured',
      variant: 'info',
      dismissible: true
    }) }}

    Notification badge:
    {{ badge({
      text: '5',
      notification: true,
      a11y: { ariaLabel: '5 unread messages' }
    }) }}

    Status dot:
    {{ badge({
      dot: true,
      variant: 'success',
      a11y: { ariaLabel: 'Online' }
    }) }}
#}

{% macro badge(props = {}) %}
  {% set defaults = {
    text: '',
    variant: 'default',
    size: 'md',
    style: 'filled',
    shape: '',
    icon: '',
    dismissible: false,
    notification: false,
    dot: false,
    className: '',
    attributes: {},
    a11y: {}
  } %}

  {% set config = defaults | merge(props) %}

  {# Build class list #}
  {% set classList = ['badge'] %}

  {# Add color variant (skip 'default' as it's the base style) #}
  {% if config.variant != 'default' %}
    {% set classList = (classList.push('badge-' + config.variant), classList) %}
  {% endif %}

  {# Add size variant #}
  {% if config.size %}
    {% set classList = (classList.push('badge-' + config.size), classList) %}
  {% endif %}

  {# Add style variant (outline, subtle) #}
  {% if config.style == 'outline' %}
    {% set classList = (classList.push('badge-outline'), classList) %}
  {% elif config.style == 'subtle' %}
    {% set classList = (classList.push('badge-subtle'), classList) %}
  {% endif %}

  {# Add shape variant #}
  {% if config.shape == 'rounded' %}
    {% set classList = (classList.push('badge-rounded'), classList) %}
  {% elif config.shape == 'pill' %}
    {% set classList = (classList.push('badge-pill'), classList) %}
  {% endif %}

  {# Special badge types #}
  {% if config.notification %}
    {% set classList = (classList.push('badge-notification'), classList) %}
  {% elif config.dot %}
    {% set classList = (classList.push('badge-dot'), classList) %}
  {% endif %}

  {# Add custom classes #}
  {% if config.className %}
    {% set classList = (classList.push(config.className), classList) %}
  {% endif %}

  {# Determine element type - use button if dismissible, span otherwise #}
  {% set tagName = 'button' if config.dismissible and not config.dot and not config.notification else 'span' %}

  {# Main component element #}
  <{{ tagName }}
    class="{{ classList | join(' ') }}"
    {% if config.id %}id="{{ config.id }}"{% endif %}
    {% if config.a11y.role %}role="{{ config.a11y.role }}"{% endif %}
    {% if config.a11y.ariaLabel %}aria-label="{{ config.a11y.ariaLabel }}"{% endif %}
    {% if config.a11y.ariaDescribedBy %}aria-describedby="{{ config.a11y.ariaDescribedBy }}"{% endif %}
    {% if config.a11y.ariaLive %}aria-live="{{ config.a11y.ariaLive }}"{% endif %}
    {% if config.dismissible and tagName == 'button' %}type="button"{% endif %}
    {% for key, value in config.attributes %}
      {{ key }}="{{ value }}"
    {% endfor %}
  >
    {# Don't render content for dot indicators #}
    {% if not config.dot %}
      {# Icon (if provided) #}
      {% if config.icon %}
        <span class="badge-icon" aria-hidden="true">
          {{ config.icon | safe }}
        </span>
      {% endif %}

      {# Text content #}
      {% if config.text %}
        <span class="badge-text">{{ config.text }}</span>
      {% endif %}

      {# Dismissible close button #}
      {% if config.dismissible %}
        <button
          class="badge-close"
          type="button"
          aria-label="Remove badge"
        >
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M9 3L3 9M3 3L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      {% endif %}

      {# Allow caller content for custom badge content #}
      {{ caller() if caller }}
    {% endif %}
  </{{ tagName }}>
{% endmacro %}
