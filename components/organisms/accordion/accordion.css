/**
 * Accordion/FAQ Organism Component
 *
 * Description: Collapsible Q&A sections for FAQs, feature details, and content organization.
 * Provides smooth animations, keyboard navigation, and multiple behavior modes.
 *
 * Marketing Context:
 * - 70% of B2B buyers check FAQ before contacting sales
 * - 20% increase in conversion when FAQ placed before final CTA
 * - Critical for objection handling and reducing pre-purchase friction
 *
 * Variants:
 * - Behavior: single-open (accordion), multi-open (toggle), all-open (static)
 * - Visual: default, bordered, card, minimal
 * - Icon position: left, right
 *
 * Features:
 * - Smooth expand/collapse animation
 * - Keyboard navigation (Enter, Space, Arrow keys)
 * - Deep linking via URL hash
 * - WCAG AA compliant
 * - Dark mode support
 */

@layer components {
  /* ============================================================================
     BASE ACCORDION STYLES
     ============================================================================ */

  .accordion {
    --accordion-gap: var(--spacing-md);
    --accordion-padding: var(--spacing-lg);
    --accordion-border-color: var(--color-border);
    --accordion-border-width: var(--border-width-thin);
    --accordion-border-radius: var(--border-radius-lg);
    --accordion-background: var(--color-surface);
    --accordion-shadow: var(--shadow-sm);

    /* Typography */
    --accordion-question-size: var(--font-size-lg);
    --accordion-question-weight: var(--font-weight-semibold);
    --accordion-question-color: var(--color-text);
    --accordion-answer-size: var(--font-size-base);
    --accordion-answer-color: var(--color-text-muted);

    /* Icon */
    --accordion-icon-size: 1.5rem;
    --accordion-icon-color: var(--color-text-muted);

    /* Hover states */
    --accordion-hover-bg: var(--color-surface-alt);
    --accordion-hover-question-color: var(--color-primary-600);

    /* Transitions */
    --accordion-transition: var(--transition-base);
    --accordion-icon-rotation: 180deg;

    width: 100%;
    max-width: var(--container-3xl);
    margin-inline: auto;
  }

  /* ============================================================================
     HEADER (TITLE + SUBTITLE)
     ============================================================================ */

  .accordion-header {
    text-align: center;
    margin-block-end: var(--spacing-2xl);
  }

  .accordion-title {
    margin: 0;
    margin-block-end: var(--spacing-sm);
    font-size: clamp(var(--font-size-2xl), 4vw, var(--font-size-3xl));
    font-weight: var(--font-weight-bold);
    color: var(--color-text);
    line-height: var(--line-height-tight);
  }

  .accordion-subtitle {
    margin: 0;
    font-size: var(--font-size-lg);
    color: var(--color-text-muted);
    line-height: var(--line-height-normal);
  }

  /* ============================================================================
     ACCORDION LIST
     ============================================================================ */

  .accordion-list {
    display: flex;
    flex-direction: column;
    gap: var(--accordion-gap);
  }

  /* ============================================================================
     ACCORDION ITEM
     ============================================================================ */

  .accordion-item {
    border: var(--accordion-border-width) solid var(--accordion-border-color);
    border-radius: var(--accordion-border-radius);
    background: var(--accordion-background);
    overflow: hidden;
    transition: all var(--accordion-transition);
  }

  .accordion-item:hover {
    box-shadow: var(--accordion-shadow);
  }

  /* Open state */
  .accordion-item-open .accordion-trigger {
    color: var(--accordion-hover-question-color);
  }

  /* ============================================================================
     ACCORDION TRIGGER (BUTTON)
     ============================================================================ */

  .accordion-trigger {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: var(--accordion-padding);
    font-family: var(--font-sans);
    font-size: var(--accordion-question-size);
    font-weight: var(--accordion-question-weight);
    color: var(--accordion-question-color);
    text-align: start;
    background: transparent;
    border: none;
    cursor: pointer;
    transition: color var(--accordion-transition);

    /* Ensure touch targets meet WCAG AA minimum */
    min-block-size: 44px;
  }

  .accordion-trigger:hover {
    color: var(--accordion-hover-question-color);
  }

  .accordion-trigger:focus-visible {
    outline: 3px solid var(--color-border-focus);
    outline-offset: -3px;
    z-index: 1;
  }

  /* ============================================================================
     ACCORDION QUESTION TEXT
     ============================================================================ */

  .accordion-question {
    flex: 1;
    line-height: var(--line-height-snug);
    text-align: start;
  }

  /* ============================================================================
     ACCORDION ICON
     ============================================================================ */

  .accordion-icon {
    flex-shrink: 0;
    inline-size: var(--accordion-icon-size);
    block-size: var(--accordion-icon-size);
    margin-inline-start: var(--spacing-md);
    color: var(--accordion-icon-color);
    transition: transform var(--accordion-transition);
  }

  /* Rotate icon when open */
  .accordion-item-open .accordion-icon {
    transform: rotate(var(--accordion-icon-rotation));
  }

  /* Icon left variant */
  .accordion-icon-left .accordion-trigger {
    flex-direction: row-reverse;
  }

  .accordion-icon-left .accordion-icon {
    margin-inline-start: 0;
    margin-inline-end: var(--spacing-md);
  }

  /* ============================================================================
     ACCORDION PANEL (CONTENT CONTAINER)
     ============================================================================ */

  .accordion-panel {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows var(--accordion-transition);
    overflow: hidden;
  }

  .accordion-panel[hidden] {
    display: none;
  }

  /* Open state - expand to content height */
  .accordion-item-open .accordion-panel:not([hidden]) {
    grid-template-rows: 1fr;
  }

  /* ============================================================================
     ACCORDION CONTENT (INNER WRAPPER FOR ANSWER)
     ============================================================================ */

  .accordion-content {
    min-block-size: 0;
    padding-block-start: 0;
    padding-block-end: var(--accordion-padding);
    padding-inline: var(--accordion-padding);
  }

  .accordion-content > * {
    font-size: var(--accordion-answer-size);
    line-height: var(--line-height-relaxed);
    color: var(--accordion-answer-color);
  }

  .accordion-content > *:first-child {
    margin-block-start: 0;
  }

  .accordion-content > *:last-child {
    margin-block-end: 0;
  }

  /* Links in answers */
  .accordion-content a {
    color: var(--color-text-link);
    text-decoration: underline;
    transition: color var(--accordion-transition);
  }

  .accordion-content a:hover {
    color: var(--color-text-link-hover);
  }

  /* ============================================================================
     VISUAL VARIANTS
     ============================================================================ */

  /* Bordered variant - thicker border, highlight on open */
  .accordion-bordered .accordion-item {
    border-width: 2px;
    border-color: var(--color-gray-300);
  }

  .accordion-bordered .accordion-item-open {
    border-color: var(--color-primary-500);
  }

  /* Card variant - elevated with shadow */
  .accordion-card .accordion-item {
    box-shadow: var(--shadow-md);
    border: none;
  }

  .accordion-card .accordion-item:hover {
    box-shadow: var(--shadow-lg);
  }

  .accordion-card .accordion-item-open {
    box-shadow: var(--shadow-xl);
  }

  /* Minimal variant - borderless with subtle dividers */
  .accordion-minimal .accordion-item {
    border: none;
    border-block-end: var(--accordion-border-width) solid var(--accordion-border-color);
    border-radius: 0;
    background: transparent;
  }

  .accordion-minimal .accordion-item:first-child {
    border-block-start: var(--accordion-border-width) solid var(--accordion-border-color);
  }

  .accordion-minimal .accordion-item:hover {
    background: var(--accordion-hover-bg);
    box-shadow: none;
  }

  .accordion-minimal .accordion-item-open {
    background: var(--accordion-hover-bg);
  }

  /* ============================================================================
     GROUPED BY CATEGORY
     ============================================================================ */

  .accordion-grouped {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-3xl);
  }

  .accordion-category {
    width: 100%;
  }

  .accordion-category-title {
    margin: 0;
    margin-block-end: var(--spacing-lg);
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text);
    line-height: var(--line-height-tight);
  }

  /* ============================================================================
     DARK MODE
     ============================================================================ */

  @media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) {
      --accordion-background: var(--color-gray-800);
      --accordion-border-color: var(--color-gray-700);
      --accordion-hover-bg: var(--color-gray-900);
      --accordion-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.3);
    }
  }

  [data-theme="dark"] {
    --accordion-background: var(--color-gray-800);
    --accordion-border-color: var(--color-gray-700);
    --accordion-hover-bg: var(--color-gray-900);
    --accordion-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.3);
  }

  /* ============================================================================
     RESPONSIVE DESIGN
     ============================================================================ */

  /* Mobile optimizations */
  @media (max-width: 640px) {
    .accordion {
      --accordion-padding: var(--spacing-md);
      --accordion-gap: var(--spacing-sm);
      --accordion-question-size: var(--font-size-base);
      --accordion-answer-size: var(--font-size-sm);
      --accordion-icon-size: 1.25rem;
    }

    .accordion-header {
      margin-block-end: var(--spacing-xl);
      text-align: start;
    }

    .accordion-title {
      font-size: var(--font-size-2xl);
    }

    .accordion-subtitle {
      font-size: var(--font-size-base);
    }
  }

  /* ============================================================================
     ACCESSIBILITY - REDUCED MOTION
     ============================================================================ */

  @media (prefers-reduced-motion: reduce) {
    .accordion-item,
    .accordion-trigger,
    .accordion-icon,
    .accordion-panel {
      transition: none;
    }

    .accordion-panel {
      transition: grid-template-rows 0s;
    }
  }

  /* ============================================================================
     PRINT STYLES
     ============================================================================ */

  @media print {
    .accordion-item {
      page-break-inside: avoid;
    }

    /* Show all content when printing */
    .accordion-panel {
      display: block !important;
      grid-template-rows: 1fr !important;
    }

    .accordion-trigger {
      pointer-events: none;
    }

    .accordion-icon {
      display: none;
    }
  }
}
