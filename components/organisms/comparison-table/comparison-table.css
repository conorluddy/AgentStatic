/**
 * Comparison Table Organism
 *
 * Marketing-optimized table for comparing plans, products, or features.
 * Implements pricing psychology principles (anchoring, highlighting, visual hierarchy).
 * Responsive design: horizontal scroll on mobile, full table on desktop.
 *
 * Features:
 * - Sticky header row with pricing and CTAs
 * - Sticky first column (feature names)
 * - Highlighted "recommended" column
 * - Category rows for feature grouping
 * - Check/cross icons for boolean features
 * - Multiple style variants
 * - Full dark mode support
 * - WCAG AA accessible
 *
 * Marketing Psychology:
 * - Anchoring effect: Show high-value plan first to anchor perception
 * - Visual prominence: Highlighted column drives 60%+ conversions
 * - Feature ordering: Most valuable features at top
 * - Goldilocks pricing: 3-column layout optimal for decision-making
 */

@layer components {
  /* ========================================================================
     BASE STYLES
     ======================================================================== */

  .comparison-table {
    /* Component custom properties */
    --ct-border-color: var(--color-border);
    --ct-header-bg: var(--color-gray-50);
    --ct-row-bg: var(--color-white);
    --ct-row-alt-bg: var(--color-gray-50);
    --ct-category-bg: var(--color-gray-100);
    --ct-category-text: var(--color-gray-700);
    --ct-highlight-bg: var(--color-primary-50);
    --ct-highlight-border: var(--color-primary-600);
    --ct-highlight-shadow: 0 8px 24px -8px rgba(37, 99, 235, 0.25);
    --ct-cell-padding: var(--spacing-md);
    --ct-header-padding: var(--spacing-lg);

    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    scroll-snap-type: x proximity; /* Snap to columns on mobile */
  }

  /* Remove default focus outline, use custom focus styles */
  .comparison-table:focus {
    outline: 2px solid var(--color-border-focus);
    outline-offset: 4px;
  }

  /* Wrapper ensures minimum width on mobile */
  .comparison-table-wrapper {
    display: inline-block;
    min-width: 100%;
  }

  /* Table reset */
  .comparison-table-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    table-layout: auto;
  }

  /* ========================================================================
     HEADER SECTION (PLAN COLUMNS)
     ======================================================================== */

  .comparison-table-header {
    position: sticky;
    top: 0;
    z-index: var(--z-10);
    background: var(--ct-row-bg);
  }

  /* Feature header (first column) */
  .comparison-table-feature-header {
    padding: var(--ct-header-padding);
    text-align: left;
    font-weight: var(--font-weight-semibold);
    font-size: var(--font-size-sm);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
    background: var(--ct-header-bg);
    border-bottom: 2px solid var(--ct-border-color);

    /* Sticky left column */
    position: sticky;
    left: 0;
    z-index: var(--z-20);
  }

  /* Plan column headers */
  .comparison-table-plan {
    padding: var(--ct-header-padding);
    text-align: center;
    vertical-align: top;
    background: var(--ct-header-bg);
    border-bottom: 2px solid var(--ct-border-color);
    position: relative;
    min-width: 200px;
  }

  /* Highlighted column (recommended/popular) */
  .comparison-table-plan-highlighted {
    background: var(--ct-highlight-bg);
    border-left: 2px solid var(--ct-highlight-border);
    border-right: 2px solid var(--ct-highlight-border);
    border-top: 2px solid var(--ct-highlight-border);
    box-shadow: var(--ct-highlight-shadow);
    transform: scale(1.02);
    z-index: var(--z-10);
  }

  /* Badge on highlighted column */
  .comparison-table-badge {
    position: absolute;
    top: calc(var(--spacing-md) * -1);
    left: 50%;
    transform: translateX(-50%);
    padding: var(--spacing-xs) var(--spacing-md);
    background: var(--ct-highlight-border);
    color: var(--color-white);
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-bold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: var(--border-radius-full);
    white-space: nowrap;
    box-shadow: var(--shadow-md);
  }

  /* Plan content wrapper */
  .comparison-table-plan-content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    align-items: center;
  }

  /* Plan title */
  .comparison-table-plan-title {
    margin: 0;
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text);
  }

  /* Plan subtitle */
  .comparison-table-plan-subtitle {
    margin: calc(var(--spacing-xs) * -1) 0 0 0;
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }

  /* Plan price */
  .comparison-table-plan-price {
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-bold);
    color: var(--ct-highlight-border);
    line-height: var(--line-height-tight);
  }

  .comparison-table-plan-price-amount {
    font-size: var(--font-size-3xl);
  }

  .comparison-table-plan-price-period {
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-normal);
    color: var(--color-text-muted);
  }

  /* Plan description */
  .comparison-table-plan-description {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    max-width: 200px;
  }

  /* ========================================================================
     BODY SECTION (FEATURE ROWS)
     ======================================================================== */

  /* Category rows */
  .comparison-table-category-row {
    background: var(--ct-category-bg);
  }

  .comparison-table-category {
    padding: var(--spacing-sm) var(--ct-cell-padding);
    font-weight: var(--font-weight-semibold);
    font-size: var(--font-size-sm);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--ct-category-text);
    border-bottom: 1px solid var(--ct-border-color);

    /* Span all columns */
    text-align: left;

    /* Sticky left on mobile */
    position: sticky;
    left: 0;
    z-index: var(--z-10);
  }

  /* Feature name cell (first column) */
  .comparison-table-feature {
    padding: var(--ct-cell-padding);
    text-align: left;
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
    background: var(--ct-row-bg);
    border-bottom: 1px solid var(--ct-border-color);

    /* Sticky left column */
    position: sticky;
    left: 0;
    z-index: var(--z-10);
  }

  .comparison-table-feature-tooltip {
    display: inline-block;
    margin-left: var(--spacing-xs);
    color: var(--color-text-muted);
    cursor: help;
  }

  /* Feature value cells */
  .comparison-table-value {
    padding: var(--ct-cell-padding);
    text-align: center;
    vertical-align: middle;
    background: var(--ct-row-bg);
    border-bottom: 1px solid var(--ct-border-color);
    font-size: var(--font-size-base);
    color: var(--color-text);
  }

  /* Highlighted column values */
  .comparison-table-plan-highlighted ~ .comparison-table-value-highlighted,
  tr:has(.comparison-table-plan-highlighted) .comparison-table-value-highlighted {
    background: var(--ct-highlight-bg);
    border-left: 2px solid var(--ct-highlight-border);
    border-right: 2px solid var(--ct-highlight-border);
  }

  /* Last row in highlighted column */
  tbody tr:last-child .comparison-table-value-highlighted {
    border-bottom: 2px solid var(--ct-highlight-border);
  }

  /* Check/cross icons */
  .comparison-table-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.5rem;
    height: 1.5rem;
  }

  .comparison-table-icon svg {
    width: 100%;
    height: 100%;
  }

  .comparison-table-icon-yes {
    color: var(--color-success);
  }

  .comparison-table-icon-no {
    color: var(--color-gray-400);
  }

  /* Screen reader only text for icons */
  .comparison-table-sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* ========================================================================
     VARIANT: BORDERED
     ======================================================================== */

  .comparison-table-bordered .comparison-table-table {
    border: 1px solid var(--ct-border-color);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
  }

  .comparison-table-bordered th,
  .comparison-table-bordered td {
    border-right: 1px solid var(--ct-border-color);
  }

  .comparison-table-bordered th:last-child,
  .comparison-table-bordered td:last-child {
    border-right: none;
  }

  /* ========================================================================
     VARIANT: STRIPED
     ======================================================================== */

  .comparison-table-striped tbody tr:nth-child(even) .comparison-table-feature,
  .comparison-table-striped tbody tr:nth-child(even) .comparison-table-value {
    background: var(--ct-row-alt-bg);
  }

  .comparison-table-striped tbody tr:nth-child(even) .comparison-table-value-highlighted {
    background: var(--ct-highlight-bg);
  }

  /* ========================================================================
     VARIANT: MINIMAL
     ======================================================================== */

  .comparison-table-minimal .comparison-table-feature-header,
  .comparison-table-minimal .comparison-table-plan {
    background: transparent;
    border-bottom: 1px solid var(--ct-border-color);
  }

  .comparison-table-minimal .comparison-table-plan-highlighted {
    background: var(--ct-highlight-bg);
  }

  .comparison-table-minimal .comparison-table-category {
    background: transparent;
    padding-top: var(--spacing-lg);
  }

  /* ========================================================================
     RESPONSIVE: MOBILE CARDS (OPTIONAL)
     ======================================================================== */

  @media (max-width: 767px) {
    /* Mobile: Horizontal scroll by default */
    .comparison-table {
      margin: 0 calc(var(--spacing-md) * -1);
      padding: 0 var(--spacing-md);
    }

    /* Reduce padding on mobile */
    .comparison-table-plan,
    .comparison-table-feature-header {
      padding: var(--spacing-md);
      min-width: 160px;
    }

    .comparison-table-feature,
    .comparison-table-value {
      padding: var(--spacing-sm) var(--spacing-md);
    }

    /* Smaller text on mobile */
    .comparison-table-plan-title {
      font-size: var(--font-size-lg);
    }

    .comparison-table-plan-price {
      font-size: var(--font-size-xl);
    }

    .comparison-table-plan-price-amount {
      font-size: var(--font-size-2xl);
    }

    /* Badge positioning */
    .comparison-table-badge {
      font-size: 0.625rem;
      padding: 0.25rem var(--spacing-sm);
    }

    /* Cards variant: Stack columns as cards */
    .comparison-table-cards .comparison-table-wrapper {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-lg);
    }

    .comparison-table-cards .comparison-table-table,
    .comparison-table-cards thead,
    .comparison-table-cards tbody,
    .comparison-table-cards tr,
    .comparison-table-cards th,
    .comparison-table-cards td {
      display: block;
      position: static;
    }

    .comparison-table-cards .comparison-table-header {
      display: none;
    }

    .comparison-table-cards tbody {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--spacing-lg);
    }

    .comparison-table-cards .comparison-table-category-row {
      display: none;
    }

    /* Card styling for each plan */
    .comparison-table-cards tbody tr {
      display: flex;
      flex-direction: column;
      border: 1px solid var(--ct-border-color);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-lg);
      background: var(--ct-row-bg);
    }

    .comparison-table-cards .comparison-table-feature,
    .comparison-table-cards .comparison-table-value {
      border: none;
      padding: var(--spacing-sm) 0;
      text-align: left;
    }

    .comparison-table-cards .comparison-table-feature::before {
      content: attr(data-label);
      display: block;
      font-weight: var(--font-weight-semibold);
      margin-bottom: var(--spacing-xs);
    }
  }

  /* ========================================================================
     RESPONSIVE: TABLET
     ======================================================================== */

  @media (min-width: 768px) and (max-width: 1023px) {
    .comparison-table-plan,
    .comparison-table-feature-header {
      min-width: 180px;
    }
  }

  /* ========================================================================
     RESPONSIVE: DESKTOP
     ======================================================================== */

  @media (min-width: 1024px) {
    /* Wider columns on desktop */
    .comparison-table-plan {
      min-width: 220px;
    }

    /* Hover effects */
    .comparison-table-plan:hover {
      background: var(--color-gray-100);
      transition: background-color var(--transition-fast);
    }

    .comparison-table-plan-highlighted:hover {
      background: var(--ct-highlight-bg);
    }

    /* Row hover */
    tbody tr:hover .comparison-table-feature,
    tbody tr:hover .comparison-table-value {
      background: var(--color-gray-50);
    }

    tbody tr:hover .comparison-table-value-highlighted {
      background: var(--ct-highlight-bg);
    }
  }

  /* ========================================================================
     DARK MODE
     ======================================================================== */

  @media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) .comparison-table {
      --ct-border-color: var(--color-gray-700);
      --ct-header-bg: var(--color-gray-800);
      --ct-row-bg: var(--color-gray-900);
      --ct-row-alt-bg: var(--color-gray-800);
      --ct-category-bg: var(--color-gray-800);
      --ct-category-text: var(--color-gray-300);
      --ct-highlight-bg: rgba(37, 99, 235, 0.15);
      --ct-highlight-border: var(--color-primary-500);
      --ct-highlight-shadow: 0 8px 24px -8px rgba(37, 99, 235, 0.4);
    }
  }

  [data-theme="dark"] .comparison-table {
    --ct-border-color: var(--color-gray-700);
    --ct-header-bg: var(--color-gray-800);
    --ct-row-bg: var(--color-gray-900);
    --ct-row-alt-bg: var(--color-gray-800);
    --ct-category-bg: var(--color-gray-800);
    --ct-category-text: var(--color-gray-300);
    --ct-highlight-bg: rgba(37, 99, 235, 0.15);
    --ct-highlight-border: var(--color-primary-500);
    --ct-highlight-shadow: 0 8px 24px -8px rgba(37, 99, 235, 0.4);
  }

  /* ========================================================================
     ACCESSIBILITY
     ======================================================================== */

  /* Focus styles */
  .comparison-table-plan:focus-within,
  .comparison-table-feature:focus-within,
  .comparison-table-value:focus-within {
    outline: 2px solid var(--color-border-focus);
    outline-offset: -2px;
    z-index: var(--z-20);
  }

  /* High contrast mode */
  @media (prefers-contrast: high) {
    .comparison-table {
      --ct-border-color: currentColor;
      --ct-highlight-border: currentColor;
    }

    .comparison-table-plan-highlighted {
      outline: 3px solid currentColor;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .comparison-table,
    .comparison-table * {
      transition: none !important;
      animation: none !important;
    }
  }

  /* Print styles */
  @media print {
    .comparison-table {
      overflow: visible;
    }

    .comparison-table-plan,
    .comparison-table-feature {
      position: static;
    }

    .comparison-table-plan-highlighted {
      border: 2px solid #000;
    }
  }
}
